<script>
    ServerBehavior = {
      properties: {
        /**
        * Stores the server's access token.
        */
        serverAccessToken: {
          type: String,
          value: ""
        }
      },
      /**
      * Sends Facebook's access token to the server to get the server's access token.
      */
      getServerAccessToken: function () {
        var xhr = new XMLHttpRequest();

        xhr.open('GET', '/auth/facebook/token/login', true);
        xhr.setRequestHeader('access_token', this.facebookAccessToken)
        xhr.onload = function () {
          let responseUrl = xhr.responseURL

          // verifying responseUrl is valid
          if (responseUrl && responseUrl.indexOf("?") > 0 && responseUrl.indexOf("=" > 0) && responseUrl.indexOf("access_token" > 0)) {
            let queryParams = responseUrl.split("?")[1].split("=")
            let accessTokenIndex = queryParams.indexOf("access_token")
            let accessToken = queryParams[accessTokenIndex + 1]
            
            this.set("serverAccessToken", accessToken)
          } else {
            console.error("Invalid responeUrl returned: " + responseUrl)
          }
        }.bind(this)
        xhr.send(null);
      }
    };
</script>